---
title: "IMDB Rating Prediction"
output: html_document
---
############################################################################################
##Introduction
	Considering that there is a huge list of movies for a user to browse upon, the user would find it difficult to look upon each detail of the movie, evaluate it and choose the best movie of interest. To make it easier for the user, we want to evaluate how are related factors associated with the goodness of movies?  A good source to help us figure out this question is The Internet Movie Database (IMDB) website that contains numerous related features for movies. In this paper, we will focus on the movie ratings generated by users given by the website (IMDB score) and evaluate what features of the movie lead to a high or low IMDB score. A movie can be popular because of several features such as year of release, genre, director and cast popularity etc. We want to analyze the movie database to see if such biases can be brought to our attention and come up with a set of features that could strongly influence a person’s movie choice. Once we analyze this, we can easily predict the kind of movie people will like based on the IMDB score.

############################################################################################

##Dataset Selection
IMDB 5000 Movie Dataset is our selected dataset that from US World website. It contains all variables for 5043 movies, 2399 unique director names, and 30K actors/actresses. Overall, these movies span across 100 years in 66 countries. This dataset includes 28 variables. Roughly speaking, half of the variables are directly related to movies themselves, such as genres and duration. The rest half is related to the people who involved in the production of the movies, like director names and actor names. 

############################################################################################

##Variable Name	Description 
imdb_score -	The movie ratings given by IMDB website  (Response variable)

#Movie attributes
duration -	The length of the movie in minutes
Country -	The country that released the movie
title_year -	The year the movie was released in
genres	- Genre of the movie
color : Black/White or colored print
facenumber_in_poster -	The number of actors who featured on the movie poster
aspect_ratio -	the ratio of the width to the height of an image or screen.
content_rating	- Content rating of the movie
director_name -	The director of the movie
actor_1_name -Name of the leading actor

Gross	- Gross earnings of the movie in dollars
Budget -	Budget for making the movie in dollars

#Social Media Attributes

director_facebook_likesv - Number of likes on the director’s facebook page 
actor_1_facebook_likes -	No. of Facebook likes for the leading actor in the movie
actor_2_facebook_likes -	No. of Facebook likes for the 2nd actor in the movie
actor_3_facebook_likes -	No. of Facebook likes for the 3rd actor in the movie
movie_facebook_likes -	No of Facebook likes for the movie 
cast_total_facebook_likes -	Total no. of likes of all the cast members on Facebook

## Voting based
num_voted_users -	Total no of voters who voted for the movie
num_of_users_for_reviews -	Total no of imdb users who gave a review
num_of_critics_for_reviews -	Total no of critical reviews the movie

#Derived Rows
genre_count - Total numbers of genres
Budget_today_dollars - Adjusted budget acc to 2018
gross_today_dollars- Adjusted gross income acc to 2018

#Columns of interest
#Movie attributes
duration -	The length of the movie in minutes
Country -	The country that released the movie
title_year -	The year the movie was released in
genres	- Genre of the movie
color : Black/White or colored print
facenumber_in_poster -	The number of actors who featured on the movie poster
aspect_ratio -	the ratio of the width to the height of an image or screen.
content_rating	- Content rating of the movie
director_name -	The director of the movie
actor_1_name -Name of the leading actor

Gross	- Gross earnings of the movie in dollars
Budget -	Budget for making the movie in dollars

############################################################################################

####Steps Followed for analysis
##1. Data Reading, Cleaning & Variable Transformation
##2. Splitting into Training dataset
##3. Visualizing the dependence of variables with the IMDB Score
##4. Creating fucntions for correlation and Outlier detection
##5. Linear Regression model  (5 models)
##6. Validate Assumptions 
##7. Final Model selection

############################################################################################


###1. Data Reading, Cleaning & Variable Transformation

Before defining the models, the missing values of the selected variables above were removed.  
A high number of outliers were observed across variables in our dataset. These are the unusual observations that are far away from the mass of data. To treat these extremes, converted those values to reflect the average value[1]. Also, some variables were transformed to better reflect their relationship with the IMDB Score. 
●	Budget and gross values for each movie have been adjusted for inflation 
●	Transformed these adjusted values into their logarithmic form to better explain the relationship with the IMDB score.
●	From the genres associated with a film, one could identify the number of different genres a film caters to
●	Grouped the 66 countries into 6 groups - US, UK, Germany, France, Canada and others, based on the highest number of records present for each group. 



```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)

setwd("/Users/deekshajha/Desktop/Summer/3.Statistics/Proposal/round2/")
library(readxl)
data1 <- read_excel("movie_data.xlsx")
data1 <- data1[,c("aspect_ratio","title_year", "imdb_score", "color","num_critic_for_reviews", "duration","director_facebook_likes" , "actor_3_facebook_likes","actor_1_facebook_likes", "actor_2_facebook_likes", "gross","budget","genre_count","num_voted_users", "cast_total_facebook_likes" , "facenumber_in_poster","num_user_for_reviews","country_org", "Budget_today_dollars","gross_today_dollars", "movie_facebook_likes" )]   #5043
data1 <- data1[complete.cases(data1),] 
str(data1)
summary(data1)
data1_backup <- data1
table(data1$country_org)

##Taking Log of Budget and Gross

data1$logBudget = log(data1$Budget_today_dollars)
data1$loggross = log(data1$gross_today_dollars)

## Grouping countries
data1$country =""
data1$country[data1$country_org == "USA"] <- "USA"
data1$country[data1$country_org == "UK"] <- "UK"
data1$country[data1$country_org == "Germany"] <- "Germany"
data1$country[data1$country_org == "France"] <- "France"
data1$country[data1$country_org == "Canada"] <- "Canada"
data1$country[data1$country == ""] <- "Others"
  # 3801

```
Canada,Germany,UK,France,USA,Others



##2. Splitting into Training dataset
```{r x}
#Training dataset
#summary(data1)
n <- nrow(data1)
shuffled_df <- data1[sample(n), ]
train_indices <- 1:round(0.85 * n)
train <- shuffled_df[train_indices, ]
test_indices <- (round(0.85 * n) + 1):n
test <- shuffled_df[test_indices, ]
summary(train)
data2 <- data1
data1 <- train
## Our training dataset is data1
```

##
##3. Visualizing the dependence of variables with the IMDB Score

```{r scatter plots}
#Movie attributes
attach(data1)
plot(imdb_score,Budget_today_dollars)
plot(imdb_score,logBudget)
plot(imdb_score,loggross)
plot(imdb_score,gross_today_dollars)
plot(imdb_score,duration)
plot(imdb_score,facenumber_in_poster)
plot(imdb_score,genre_count)

#Social Media Attributes
plot(imdb_score,actor_1_facebook_likes)
plot(imdb_score,actor_2_facebook_likes)
plot(imdb_score,actor_3_facebook_likes)
plot(imdb_score,director_facebook_likes)
plot(imdb_score,movie_facebook_likes)  # Yes
plot(imdb_score,cast_total_facebook_likes)
plot(imdb_score,actor_1_facebook_likes+actor_2_facebook_likes+actor_3_facebook_likes)
plot(imdb_score,director_facebook_likes+movie_facebook_likes+cast_total_facebook_likes) # #
plot(imdb_score, actor_1_facebook_likes+actor_2_facebook_likes+actor_3_facebook_likes + director_facebook_likes+movie_facebook_likes+cast_total_facebook_likes)  

## Voting based
plot(imdb_score,num_critic_for_reviews)  #Strong
plot(imdb_score,num_user_for_reviews)  


# relationship observed
plot(imdb_score,duration)
plot(imdb_score,movie_facebook_likes)
plot(imdb_score,num_critic_for_reviews)
plot(imdb_score,num_user_for_reviews)
plot(imdb_score,num_voted_users)


# Scatterplot Matrix
pairs(~ imdb_score + num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes + actor_3_facebook_likes + movie_facebook_likes + director_facebook_likes + cast_total_facebook_likes  + num_voted_users + duration + genre_count + facenumber_in_poster + logBudget + gross_today_dollars , main="Simple Scatterplot Matrix")
```

##4. Creating fucntions for correlation and Outlier detection
## Remove Outliers 

```{r Correlation, echo=FALSE}
  remove_outliers <- function(x, na.rm = TRUE, ...) {
  qnt <- quantile(x, probs=c(.25, .75), na.rm = na.rm, ...)
  H <- 1.5 * IQR(x, na.rm = na.rm)
  y <- x
  y[x < (qnt[1] - H)] <- NA
  y[x > (qnt[2] + H)] <- NA
  y
}

```


## Check Correlation 

```{r Correlation, echo=FALSE}
library(Hmisc)
###DONT RUN
#cor.test(duration,title_year)
corr_matrix = data1[c(3,1:2,5:17,19:22)]
cor(as.matrix(corr_matrix))

```

##5. Linear Regression model  
<!-- #1. Specify the Model -->
<!-- 2. Fit the Model -->
<!-- 3. Inference -->
<!-- 4. Assumptions -->
<!-- 5. Use the Model -->



#MODEL1 Considering all important variables
#Multiple R-squared:  0.4173,	Adjusted R-squared:  0.4139
```{r lm, echo=FALSE}
reg1 <- lm(imdb_score ~ num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes + actor_3_facebook_likes + movie_facebook_likes + director_facebook_likes + cast_total_facebook_likes  + num_voted_users + duration + genre_count + facenumber_in_poster +color + logBudget + loggross + aspect_ratio + country, data = data1 )
summary(reg1)
coefficients(reg1)
anova(reg1)
```


#MODEL2 Further Removing high p value variables

##Multiple R-squared:  0.4173,	Adjusted R-squared:  0.4141 
```{r lm, echo=FALSE}
reg2 <- lm(imdb_score ~ num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes + actor_3_facebook_likes + movie_facebook_likes + director_facebook_likes + cast_total_facebook_likes  + num_voted_users + duration + genre_count + facenumber_in_poster +color + logBudget + loggross + country, data = data1 )
summary(reg2)
coefficients(reg2)
anova(reg2)
```


#MODEL3  Futher Removing high p value variables 
#Multiple R-squared:  0.4165,	Adjusted R-squared:  0.4136 
```{r lm, echo=FALSE}
reg3 <-lm(imdb_score ~ num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes + actor_3_facebook_likes + movie_facebook_likes + cast_total_facebook_likes  + num_voted_users + duration + genre_count + facenumber_in_poster +color + logBudget  + country, data = data1 )
summary(reg3)
coefficients(reg3)
anova(reg3)
```


#MODEL4  Removing high p value variables
## Multiple R-squared:  0.4149,	Adjusted R-squared:  0.4125 

```{r lm, echo=FALSE}
reg4 <- lm(imdb_score ~ num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes   + cast_total_facebook_likes  + num_voted_users + duration  + facenumber_in_poster +color + logBudget  + country, data = data1 )
summary(reg4)
coefficients(reg4)
anova(reg4)
```


# Model 5
#Model not considering correlated variables
#Multiple R-squared:  0.3991,	Adjusted R-squared:  0.3969 
```{r lm, echo=FALSE}
# Var selection -> 
#>0.7
#movie_facebook_likes ~ num_critic_for_reviews
#cast_total_facebook_likes ~actor_1_facebook_likes
#cast_total_facebook_likes ~actor_2_facebook_likes 
#num_user_for_reviews ~ num_voted_users

reg5 <- lm(imdb_score ~ num_critic_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes    + num_voted_users + duration  + facenumber_in_poster +color + logBudget  + country, data = data1 )
summary(reg5)
coefficients(reg5)
anova(reg5)
anova(reg5)  #All sgnificant p values  # h0 all bi =0 no relationship


```



##6. Validate Assumptions 
```
To ensure the fitted model and inferences are valid, the following test assumptions must be verified:  
●	Random Sampling: Movies in the data set have been selected randomly and without bias, so the resulting model will not contain underling data biases (for e.g. only selecting movies from a particular year or actor or genre etc.). 
●	Stability: The process of generating IMDB Score for which we are making the inference are assumed to be fixed over the period of time the data points were collected. 
●	εi Normality :The random component of our model for the process should be normally distributed with a mean of 0 and a constant standard deviation. 
```


#reg1  FAILS
```{r Assumptions, echo=FALSE}
reg1.stres <- rstandard(reg1) 
plot(data1$imdb_score, reg1.stres, pch = 16, main = "Standardized Residual Plot", xlab = "IMDB SCORE", ylab = "Standardized Residuals")
abline(0,0, lty=2, col="red")

# normal probability plot
qqnorm(reg1.stres, main = "Normal Probability Plot", xlab = "Normal Scores", ylab = "Standardized Residuals") 
qqline(reg1.stres, col = "red")
shapiro.test(reg1.stres) # W = 0.96596, p-value < 2.2e-16
# not normal, residual plot- doesnt have 0,sd fixed
```


## reg2 FAILS
```{r Assumptions, echo=FALSE}
reg2.stres <- rstandard(reg2) 
plot(data1$imdb_score, reg2.stres, pch = 16, main = "Standardized Residual Plot", xlab = "IMDB SCORE", ylab = "Standardized Residuals")
abline(0,0, lty=2, col="red")

# normal probability plot
qqnorm(reg2.stres, main = "Normal Probability Plot", xlab = "Normal Scores", ylab = "Standardized Residuals") 
qqline(reg2.stres, col = "red")
shapiro.test(reg2.stres)  #W = 0.965, p-value < 2.2e-16
# not normal, residual plot- doesnt have 0,sd fixed
```

#reg3 FAILS
```{r Assumptions, echo=FALSE}
reg3.stres <- rstandard(reg1) 
plot(data1$imdb_score, reg3.stres, pch = 16, main = "Standardized Residual Plot", xlab = "IMDB SCORE", ylab = "Standardized Residuals")
abline(0,0, lty=2, col="red")

# normal probability plot
qqnorm(reg3.stres, main = "Normal Probability Plot", xlab = "Normal Scores", ylab = "Standardized Residuals") 
qqline(reg3.stres, col = "red")
shapiro.test(reg3.stres)  #W = 0.97393, p-value < 2.2e-16
# not normal, residual plot- doesnt have 0,sd fixed
```

#reg4 FAILS
```{r Assumptions, echo=FALSE}
reg4.stres <- rstandard(reg4) 
plot(data1$imdb_score, reg4.stres, pch = 16, main = "Standardized Residual Plot", xlab = "IMDB SCORE", ylab = "Standardized Residuals")
abline(0,0, lty=2, col="red")

# normal probability plot
qqnorm(reg4.stres, main = "Normal Probability Plot", xlab = "Normal Scores", ylab = "Standardized Residuals") 
qqline(reg4.stres, col = "red")
shapiro.test(reg4.stres)  #W = 0.964, p-value < 2.2e-16
# not normal, residual plot- doesnt have 0,sd fixed
```

#reg5
```{r Assumptions, echo=FALSE}
reg5.stres <- rstandard(reg5) 
plot(data1$imdb_score, reg5.stres, pch = 16, main = "Standardized Residual Plot", xlab = "IMDB SCORE", ylab = "Standardized Residuals")
abline(0,0, lty=2, col="red")

# normal probability plot
qqnorm(reg5.stres, main = "Normal Probability Plot", xlab = "Normal Scores", ylab = "Standardized Residuals") 
qqline(reg5.stres, col = "red")
shapiro.test(reg5.stres)  #W = 0.953, p-value < 2.2e-16
# not normal, residual plot- doesnt have 0,sd fixed
```


##7. Final Model selection

The assumptions don’t hold true all models. We need to be cautious while utilizing it.
However, since Model4 is able to explain the most variance ( above 40%) , using only  11 variables, we can use that for our model.

Final model :- 
imdb_score ~ num_critic_for_reviews + num_user_for_reviews +  title_year + actor_1_facebook_likes + actor_2_facebook_likes   + cast_total_facebook_likes  + num_voted_users + duration  + facenumber_in_poster +color + logBudget  + country


##Conclusion

We are able to predict the IMDB score using a 11 variable model that can explain 40% of the variability in the data. However, we have to be cautious while using this model. There is clearly a scope of further improvement. 


